function mobile(){return"undefined"!=typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}var app=app||{};app={models:{curTrack:-1,isDragging:!1,audio:new Audio},controllers:{loadTrack:function(a){app.models.curTrack=a,app.models.audio.setAttribute("src",app.models.tracks[a].src),app.models.audio.play(),app.views.updatePlaylist(a),app.views.updateAudioInfo(a),app.views.updatePlayerControls(app.models.audio.paused)},playTrack:function(){app.models.audio.paused?(app.models.audio.play(),app.views.updateProgress()):app.models.audio.pause(),app.views.updatePlayerControls(app.models.audio.paused)},nextTrack:function(){var a=parseInt(app.models.curTrack)+1<app.models.tracks.length?parseInt(app.models.curTrack)+1:0;app.controllers.loadTrack(a)},prevTrack:function(){var a=parseInt(app.models.curTrack)>0?parseInt(app.models.curTrack)-1:app.models.tracks.length-1;app.controllers.loadTrack(a)},seekTrack:function(a){app.models.audio.currentTime=a*app.models.audio.duration,app.views.updateProgress()}},views:{updateNavigation:function(){$(".expand-icon, .collapse-icon").toggleClass("hidden")},updateBuffered:function(){$(".progress-preview").remove();for(var a=[],b=0;b<app.models.audio.buffered.length;b++)a.push([100/app.models.audio.duration*app.models.audio.buffered.start(b),100/app.models.audio.duration*app.models.audio.buffered.end(b)]);for(var b=0;b<a.length;b++)$("#progressBar").append('<div class="progress-preview" style="left:'+a[b][0]+"%; width:"+a[b][1]+'%;"></div>')},updateProgress:function(){var a=$("#progress"),b=app.models.audio.currentTime>0?100/app.models.audio.duration*app.models.audio.currentTime:0;a.css({width:b+"%"})},updatePlayerControls:function(a){a?($(".pause-icon").addClass("hidden"),$(".play-icon").removeClass("hidden")):($(".pause-icon").removeClass("hidden"),$(".play-icon").addClass("hidden"))},updateAudioInfo:function(a){$(".audio-info .song-title").empty().append(app.models.tracks[a].title),$(".audio-info .artist-album-info").empty().append(app.models.tracks[a].artist+" | "+app.models.tracks[a].album),$(".album-cover").empty().append('<img src="'+app.models.tracks[a].cover+'">'),void 0!==app.models.tracks[a].waveform&&$(".waveform").css({"background-image":"url("+app.models.tracks[a].waveform+")"}),$(".download").parent().is("a")&&$(".download").unwrap(),$(".download").wrap('<a href="'+app.models.tracks[a].src+'" target="_blank"></a>')},updateDuration:function(){var a=app.models.audio.currentTime;minutes=Math.floor(a/60),minutes=minutes>=10?minutes:"0"+minutes,a=Math.floor(a%60),a=a>=10?a:"0"+a,$(".audio-info .song-duration").empty().append(minutes+":"+a)},updatePlaylist:function(a){var b=$(".playlist").children("#"+a);$(".action-icon").removeClass("hidden"),$(".playing-icon").addClass("hidden"),b.find(".action-icon, .playing-icon").toggleClass("hidden"),$(".this .collapse-icon").toggleClass("hidden")},togglePlaylistPlayer:function(){$("#playlist-view").toggleClass("pos-left"),$("#player-view").toggleClass("pos-right")},openPlayer:function(){$("#playlist-view").addClass("pos-left"),$("#player-view").removeClass("pos-right")},openPlaylist:function(){$("#playlist-view").removeClass("pos-left"),$("#player-view").addClass("pos-right")}},bindAudioEvents:function(){app.models.audio.addEventListener("timeupdate",this.views.updateProgress,!1),app.models.audio.addEventListener("ended",this.controllers.nextTrack,!1),app.models.audio.addEventListener("progress",this.views.updateBuffered,!1)},bindEvents:function(){$(".left-btn").on("vclick",function(a){a.preventDefault(),$("#playlist-view").hasClass("pos-left")&&(app.views.openPlaylist(),app.views.updateNavigation())}),$(".right-btn").on("vclick",function(a){a.preventDefault(),app.views.togglePlaylistPlayer(),app.views.updateNavigation()}),$(".prev").on("vclick",function(){app.controllers.prevTrack()}),$(".next").on("vclick",function(){app.controllers.nextTrack()}),$(".play-pause").on("vclick",function(a){a.preventDefault(),app.controllers.playTrack()}),$(".progress-bar").on("vclick",function(a){{var b=$(this).offset(),c=$(this).width(),d=a.pageX-b.left;a.pageY-b.top}app.controllers.seekTrack(d/c)}),mobile()||$(".progress-bar").mousedown(function(){$(this).mousemove(function(a){app.models.isDragging=!0;{var b=$(this).offset(),c=$(this).width(),d=a.pageX-b.left;a.pageY-b.top}app.controllers.seekTrack(d/c)})}).mouseup(function(){app.models.isDragging;app.models.isDragging=!1,$(this).unbind("mousemove")}),mobile()&&$("#progressBar").on("vmousemove",function(a){var b=$(this).offset(),c=$(this).width(),d=a.pageX-b.left,e=(a.pageY-b.top,d/c*100);$(this).find(".progress-preview").css({width:e+"%"}),app.controllers.seekTrack(d/c)})},bootstrap:function(a){app.models.tracks=a,$(".playlist").empty(),$(".playlist").append('<li class="playlist-buffer"></li>'),$.each(app.models.tracks,function(a,b){b.id=a;var c=_.template(Templates.track,b);$(".playlist").append(c)}),mobile()&&(myScroll=new iScroll("playlist-view")),app.bindEvents(),app.bindAudioEvents()},init:function(){$.getJSON("playlist.json",this.bootstrap),document.audio=this.models.audio}},app.init(),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},Templates={},Templates.track=['<li id="{{id}}" class="playlist-track">','<div class="thumbnail" style="background-image:url({{cover}});" ></div>','<div class="song-meta">','<h2 class="song-title">{{title}}</h2>','<h4 class="song-info">','<span class="artist">{{artist}}</span>','<span class="album">{{album}}</span>',"</h4>","</div>",'<div class="action">','<div data-icon="b" class="icon action-icon"></div>','<div data-icon="&quot;" class="icon playing-icon hidden"></div>',"</div>","</li>"].join("\n");
//# sourceMappingURL=application.min.js.map